import { configure } from "mobx";
import React from "react";
import { createRoot } from "react-dom/client";
import { HashRouter } from "react-router-dom";
import { Toaster } from "sonner";
import Container from "./container";
import { Preferences } from "./hooks/stores/preferences";
import "./index-compiled.css"; // generated by tailwindcss; see package.jsons scripts
import "./prism-code-theme.css";

// todo: refactor and enforce actions on mobx stores
configure({ enforceActions: "never" });

const root = createRoot(document.getElementById("app")!);

// Rely on localStorage to ensure the last used dark mode setting is applied
// on launch. This avoids a flash of the wrong mode while the app stores
// initialize. See ThemeWatcher.
const theme = localStorage.getItem("darkMode") || "system";
document.documentElement.classList.add(theme);

root.render(
  <>
    <HashRouter>
      <Toaster
        theme={theme as Preferences["darkMode"]}
        duration={3000}
        position="bottom-right"
        toastOptions={{
          classNames: {
            toast:
              "px-2 py-4 group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
            description: "group-[.toast]:text-muted-foreground",
            actionButton:
              "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
            cancelButton:
              "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
          },
        }}
      />
      <Container />
    </HashRouter>
  </>,
);
